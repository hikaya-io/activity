{% extends "publicdashboards.html" %}
{% load humanize %}
{% block content %}

<!--- Hosted Leaflet CSS --->
<link rel="stylesheet" href="{{ STATIC_URL }}css/leaflet.css">
<link rel="borders" type="application/json" href="js/world_borders.geojson">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/main.css">
<link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/Leaflet.Photo.css">
<link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/map.css">
<link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/MarkerCluster.css">
<link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/leaflet-sidebar.css">
<link rel="stylesheet" href="{{ STATIC_URL }}js/highcharts/api/css/font-awesome.css">
<link rel="borders" type="application/json" href="{{ STATIC_URL }}publicdashboard/js/AFG.geojson">

<script src="{{ STATIC_URL }}publicdashboard/js/vendor/modernizr-2.8.3.min.js"></script>
<script src="https://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/vendor/leaflet.js"></script>
<script src="{{ STATIC_URL }}js/leaflet-sidebar.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/leaflet-google.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/leaflet.markercluster.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/Leaflet.Photo.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/reqwest.min.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/leaflet-providers.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/jquery-1.11.3.js"></script>
<script src="{{ STATIC_URL }}publicdashboard/js/vendor/Chart.min.js"></script>

<div class="wrapper">

    <h3>{% if getProgram %}{{ getProgram.name }}{% endif %}</h3>
    <div class="widget">
        <div id="sidebar" class="sidebar collapsed">
            <!-- Nav tabs -->
            <div class="sidebar-tabs">
                <ul role="tablist">
                    <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                    <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
                    <li><a href="#focus" role="tab"><i class="fa fa-tasks"></i></a></li>
                    <li><a href="#demographic" role="tab"><i class="fa fa-users"></i></a></li>
                     <li><a href="#m_e" role="tab"><i class="fa fa-folder-open"></i></a></li>
                </ul>

                <ul role="tablist">
                    <li><a href="#gallery" role="tab"><i class="fa fa-camera"></i></a></li>
                    <li><a href="#stories" role="tab"><i class="fa fa-gift"></i></a></li>
                    <li><a href="#i_surveys" role="tab"><i class="fa fa-list-alt"></i></a></li>
                    <li><a href="#contacts" role="tab"><i class="fa fa-envelope"></i></a></li>
                </ul>
            </div>
            <!-- Tab panes -->
            <div class="sidebar-content">
                <div class="sidebar-pane" id="home">
                    <h1 class="sidebar-header">About INVEST:<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                        <b>INVEST </b>seeks to address the longer-term needs identified by IDPs by providing vocational training linked to economic opportunities within the locale, and by delivering life skills modules to further support graduates and aid repatriation to home provinces. The program will deliver market-specific vocational and life skills training to 7,500 vulnerable individuals in Kandahar, Afghanistan by 2017.
                        <br/><br/>In 2011, UNHCR and the World Bank completed research on IDPs in Kabul, Kandahar and Herat cities interviewing 450 IDP households. UNHCR found that conflict-induced displacement, limited reintegration opportunities for returning refugees, the rapid growth of cities, and the proliferation of informal settlements constitute an enormously complex challenge for the government, municipalities, and humanitarian and development actors in Afghanistan. The study highlighted that displacement to urban centers is rarely temporary, at least partly due to livelihood opportunities; and that IDPs have fewer labor market opportunities than host community members. This is mainly due to the lack of skills adapted to the economic context and lower literacy rate, which translates into lower earning capacity and higher vulnerability to poverty.
                        <br/><br/>International and national groups deliver humanitarian assistance, yet there is an acute demand for funding to shift towards economic recovery and direct livelihood opportunities for the returnee and IDP population. Afghan and international actors must go beyond a purely humanitarian approach and look for sustainable solutions for IDPs. Market-driven, short-term technical and life skills training linked to job placements – that support existing Afghan government interventions - can address this demand.
                        <br/><br/>Since trainings began in the first year of INVEST-in-Kandahar, we have received numerous requests from various communities and government departments to offer technical vocational and educational (TVET) courses in their localities, further emphasizing the desire for more sustainable support. UNOCHA also highlighted the benefit of vocational training or educational support to displaced persons as a means of supporting sustainable reintegration and mitigating various protection risks. Building on the successful DFID-funded INVEST model in Helmand, the program conducted a detailed market assessment in Kandahar to identify key in-demand skills in the current marketplace, which has guided the selection of courses offered.
                </div>
                <div class="sidebar-pane" id="profile">
                    <h1 class="sidebar-header">Business Partnerships<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                    Mercy Corps has partnered with nearly 400 local business with the goal of employing INVEST participants in the fields they study. These partnerships are an integral part of INVEST’s success.
                    <br/><br/>By connecting participants with local, skilled businesses, participants continue to gain skills while developing community.
                </div>
                <div class="sidebar-pane" id="focus">
                    <h1 class="sidebar-header">How Do the VTCs Work?<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                    <b>Area of Focus - Kandahar City, Dand, Daman, Arghandab and Spin Boldack Districts</b><br/>
                    The VTCs deliver short courses (3 months or 6 months, 2 hours x 6 days/week) for 7,500 students. Subjects are those for which skills were found to be in demand in the local market, and include mobile phone repair, plumbing, wiring, embroidery and tailoring. Mercy Corps has learned from its work in Helmand that students that have limited experience with a classroom setting prefer classes that are of short duration, practical and intensive. This furthermore recognizes the importance of providing education opportunities that are adaptive to the familial and financial obligations that constrain the majority of Afghan returnees. Graduates are linked to the market in part through their instructors who are themselves master craftsmen and successful business owners in their specific trade . In addition to vocational training, graduates have the opportunity to participate in Ready to Earn Clubs (RECs); these clubs are built on Mercy Corps’ experience which has led us to go beyond traditional livelihood programming, recognizing that young people need support beyond just technical skills to successfully enter the market and to be productive members of society.
                    <br/><br/>Young people – particularly those growing up in a context of violent instability and uncertainty – also need access to opportunity, knowledge of how to make the most of that opportunity, and of what support exists for them in the local environment. The RECs represent a more holistic approach to the needs of the target population by providing support in business skills and basic financial management, in addition to transferable skills which have a demonstrated positive influence on employment and more explicit links to market actors. Importantly, RECs also offer a continued sense of community for INVEST participants, a supportive social environment in which graduates can come together to collaborate, support each other in their new ventures, and share experiences.
                    <br/><br/>Student recruitment occurs in partnership with entities in Kandahar that register IDPs and returnees, the Department of Women’s Affairs and other NGO actors operating in Kandahar. In addition, Mercy Corps Pakistan’s programming in Quetta has been working on vocational training with Afghan Refugees for many years and acts as a cross-border referral system for Afghan refugees seeking to become returnees to their provinces of origin in Kandahar and Helmand.
                    <br/><br/>INVEST is built upon community trust and mutual desire for sustainable solutions. Now that the value of the program has been clearly established, participants have started to pay fees for their training course. Different approaches are also being trialed to begin to pave the way for a fully cost recoverable training mechanism to be left behind once the donor funded program comes to an end.
                </div>
                <div class="sidebar-pane" id="demographic">
                    <h1 class="sidebar-header">Who's INVEST's Target Demographic?<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                    The target population of INVEST-in-Kandahar is Afghan returnees and IDPs and vulnerable host community members ages 15 to 35 based in and around Kandahar City and the three neighboring districts of Dand, Daman, Arghandab and Spin Boldak. Kandahar province has a population of 1.1 million with a 7.3% average literacy rate for those over 16 years old, significantly lower than the national average of 25%. The female literacy rate is even lower at just 1.3% for Kandahar compared to the national average of 11.4%. Comprehensive official statistics on the number of complaints of violence against women in Afghanistan are not available according to UNHCR, but it is understood that gender based violence exists in Kandahar at relatively high rates but that most incidents are unreported.
                    <br/><br/>Opportunities available to this demographic are very limited due to the political and economic instability in Southern Afghanistan. IDPs and returnees living in and around Kandahar City include unemployed men, women and children, few of whom have any formal education, or current access to school. Beneficiaries will be selected through referral of IDP and returnee serving organizations, local community leaders and provincial level stakeholders. Mercy Corps prioritizes: widows, illiterate and semi-literate returnees, heads of households without working dependents (prioritizing female headed households), unemployed or underemployed youth, migrants to urban Kandahar, and those that have been displaced. We also allocate at least 5% of class placements to people with disabilities.
                    <br/><br/>INVEST-in-Kandahar supported TVET courses are delivered by local master craftsmen and are practical and pragmatic to accommodate literacy levels; participation in INVEST offers both formal qualifications and enhanced life skills. The scale of the program allows for a large numbers of trainees diluting issues such as nepotism, patronage and preferential status within the IDP and returnee communities. Students are recommended and sponsored by responsible and acknowledged leaders in the community who then support the students in their future endeavors.
                </div>
                <div class="sidebar-pane" id="m_e">
                    <h1 class="sidebar-header">M&E Practices<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                </div>
                <div class="sidebar-pane" id="gallery">
                    <h1 class="sidebar-header">Photo Gallery<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                </div>
                <div class="sidebar-pane" id="stories">
                    <h1 class="sidebar-header">Success Stories<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                </div>
                <div class="sidebar-pane" id="i_surveys">
                    <h1 class="sidebar-header">Market Research Survey<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                The survey was conducted over a two-week period between 25 January 2015 and 5 February 2015 consisting of a sample of 372 respondents in order to identify specialized training courses to offer in our vocational training centers (VTC) that would have the potential of generating the greatest employment opportunities for our graduates Labor and Employment
                    <br/><br/>Unemployment and underemployment defines the labor market in Afghanistan. Around 25% of the total workforce (7.2 million) of the country is either unemployed or underemployed – and the female participation rate in the workforce is only 19% compared to 80% for males. Among 1,298 employees who were employed by 372 businesses surveyed in Kandahar, female workers constituted only 1% of the total, while 38% of the employees were relatives of the business owners – exhibiting the strong role of social networks and connections in securing jobs in the Kandahar labor market. On average, employees worked 51 hours per week which is higher than the normal 40 hours as defined by the Afghan Labor law. Employees typically worked on an informal basis as it is common practice not to sign employment contracts with their employees, as reported by 86% of the respondents. A small proportion (1.3%) of business owners acknowledged that they employed children under the age of 15.
                    <br/><br/>The survey identified the top 5 high demanded skills in the market for males are:
    <ul>
        <li>Education</li>
        <li>Sewing/Tailoring</li>
        <li>Tailoring</li>
        <li>Metalwork</li>
        <li>Electrical equipment repair</li>
    </ul>

While for females, business owners reported the top 5 high demanded skills are:
 <ol>
        <li>Sewing/Tailoring</li>
        <li>Embroidery</li>
        <li>Health services</li>
        <li>Education</li>
        <li>Handicrafts</li>
    </ol>

The trend of employment in surveyed areas was such that the majority (70%) of business owners had not hired any employees in the past year, although 57% said they plan to hire employees in the future. In hiring employees, friends and relatives were the main sources of recruitment in the businesses/workshops surveyed.

<br/><br/>The amount of salary paid by employers depended on skill level and experience of workers. Unskilled workers usually were not paid for their work, while there seemed to be a positive correlation between the skill level and experience of employees and the amount of salary they were paid per month.
<br/><br/><b>Establishment Of A Business</b>

<br/>Establishing a business requires expertise and capital. Respondents’ main sources of capital for establishing a business were their own capital and money that they have taken as loan from their family members or friends. Interestingly our results found only 8% of the respondents reporting to have taken loans through formal channels such as banks or microfinance institutions (MFI). When asked about investment opportunities, promising and profitable businesses were cited as: education, sewing/tailoring, carpentry, metalwork and repairing of electronic and non-electronic equipment. According to business owners the main factors of a successful business were; producing quality products, availability of skilled workers, access to finance and adequate capital, sound bookkeeping and business management.
<br/><br/><b>Financing A Business</b>

<br/>Converting a business idea into a profitable venture requires finance among other factors. Financing institutions, including MFIs surveyed reported to have approximately 14,500 clients in Kandahar province, among whom nearly a third (29%) are females. These institutions provide loans against collateral to all population groups irrespective of their social status such as being an IDP or returnee, however the availability of collateral is a significant limiting factor. Financial institutions provide small loans up to 25,000 Afs (390 USD) with terms of repayments on a weekly and monthly basis.
<br/><br/><b>Recommendations</b>
    <ul>
    <li>
        Based on the findings of the report on types of trades and skills demanded in the market, the top 5 trades were selected to be included as training courses in Mercy Corps’ VTCs - both for males and females. These trades are: i) Education (computer, English language and Kankor), ii) Sewing and tailoring, iii) Metal works, iv) Repairing of consumer electronics and vehicles, and v) Embroidery. Market assessments will be conducted regularly in INVEST, to ensure that the courses provided continue to accurately meet the demands of the market.
    </li>
        <li>
            Due to cultural restrictions and the subsequent lack of female business owners in the market, business owner respondents of the initial LMA were all males. Their perceptions about skills in demand for female workers therefore only reflect a limited perspective and not the whole picture. Innovative ways to access female respondents (e.g. in small home-based businesses) should be sought when carrying out future market assessments.
    </li><li>
            Due to social stigma attached to displaced persons, 31% of businesses responded that they would not accept new graduates who were IDPs in their workplaces for internships or as employees. Efforts to link graduates to the market should prioritize sectors and businesses receptive to newly graduated IDPs; as these new workers go on to demonstrate their value, so in turn this may help to re-shape attitudes and reduce stigma.
    </li><li>
        Work experience featured fairly prominently among the characteristics employers preferred in new employees. Vocational training courses should be practical in nature as far as possible rather than theoretical. The Mercy Corps methodology of employing master craftsmen to train students rather than teachers has demonstrated significant success in making students more prepared for actual employment experience.
    </li><li>
        Some businesses are more affordable to establish than others. Students should be made aware of the approximate start-up costs associated with their sector, in order to make an informed decision as to their plans after graduation (e.g. to establish themselves independently, in association with others, or seek employment in an existing business).
    </li><li>
        Since the market assessment helped identify key businesses in the targeted areas, Mercy Corps can continue to foster a relationship between these businesses and nearby VTCs in order to promote cross visits for business owners to view the work of potential graduates who may then apply to these businesses to apprenticeships or immediate employment.
    </li><li>
        Social networks have proven to be crucial to accessing employment; by assisting future employers to meet graduates we can improve their post-graduation prospects via the implicit trust that familiarity encourages.
    </li><li>
        Similarly, the social networks amongst students, which are introduced through attending training together can positively impact the opportunities that graduates have access to. Mercy Corps will build on this through the Ready to Earn Clubs, which will provide graduates with a space to maintain the relationships they have established through attending training; this may lead to direct employment through contacts of their colleagues, or indeed to the encouragement of collaboration among graduates for the purpose of establishing their own business.
    </li><li>
        The assessment supports the theory that business management knowledge is important to success in the market place. Vocational training should therefore also connect trainees who are considering establishing their own business to opportunities to develop such skills. Again Mercy Corps plans to meet this recommendation through provision of training in the Ready to Earn Clubs.
</li>
    </ul>

                </div>
                <div class="sidebar-pane" id="contacts">
                    <h1 class="sidebar-header">Contact Us<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                </div>
            </div>
        </div>
        <div id="map" class="sidebar-map"></div>
        <script>
            var country=[],country_lat=[],country_long=[], narrativeTitle=[], narrativeTXT=[], overlay=[];

            //read country GPS data into arrays
            {% for item in countries %}
                country[{{forloop.counter}}] = "{{ item.country }}";
                country_lat[{{forloop.counter}}] = "{{ item.latitude }}";
                country_long[{{forloop.counter}}] = "{{ item.longitude }}";
            {% endfor %}

             //overlay groups
             {% for group in getOverlayGroups %}
                var {{ group.overlay_group }} = new L.LayerGroup();
             {% endfor %}

            //define icons for overlay markers
            var projectIcon = L.divIcon({
              className: 'map-marker',
              html:'<div class="map-marker project"></div>',
              iconSize: [50,50]
            });
            var indicatorIcon = L.divIcon({
              className: 'marker-indicator',
              html:'<div class="marker-indicator"></div>',
              iconSize: [50,50]
            });
            var greenIcon = new L.Icon({
                iconUrl: '{{ STATIC_URL }}js/images/marker-icon-green.png',
                iconRetinaUrl: '{{ STATIC_URL }}js/images/marker-icon-2x-green.png',
                iconSize:    [25, 41],
                iconAnchor:  [12, 41],
                popupAnchor: [1, -34],
                shadowUrl: '{{ STATIC_URL }}js/images/marker-shadow.png',
                shadowSize:  [41, 41]
            });
            //partner markers
            {% for item in getSiteProfile %}
                L.marker([{{ item.latitude }}, {{ item.longitude }}], {icon: projectIcon})
                    .addTo(partners)
                    .bindPopup("<b>{{ item.country }}</b>
                                <br/>Project Site:
                                <br/><a href='/workflow/siteprofile_update/{{ item.id }}'>{{ item.name }}</a>
                                <br/>ADM1: {{ item.province }}
                                <br/>ADM2: {{ item.district }}
                                <br/>ADM3: {{ item.village }}
                                <br/>SiteProfile{{ item.name }}
                                <br/> "
                               );
            {% endfor %}

            {% if getSiteProfileIndicator %}
                //indicator markers
                {% for item in getSiteProfileIndicator %}
                    L.marker([{{ item.latitude }}, {{ item.longitude }}], {icon: indicatorIcon})
                            .addTo(indicators)
                            .bindPopup("" + "<b>{{ item.country }}</b>
                                        <br/>Collected Indicator Data Site:
                                        <br/><a href='/workflow/siteprofile_update/{{ item.id }}'>{{ item.name }}</a>
                                        <br/>ADM1: {{ item.province }}
                                        <br/>ADM2: {{ item.district }}
                                        <br/>ADM3: {{ item.village }}
                                        <br/>SiteProfile{{ item.name }}
                                        <br/> "
                                       );
                {% endfor %}
            {% endif %}

            var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',

            //basemaps from mapbox URL and leaflet-providers.js
            mbUrl = 'http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';
            var baseMap = L.tileLayer.provider('OpenStreetMap.Mapnik');

            var baseMap = L.tileLayer.provider('OpenStreetMap.Mapnik'),
                grayscale = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
                opentopomap = L.tileLayer.provider('OpenTopoMap');


            var map = L.map('map',
                       {
                        center: [country_lat[1], country_long[1]],
                        zoom: 5,
                        dragging: false,
                        touchZoom: false,
                        scrollWheelZoom: false,
                        //preselected layers
                        layers: [baseMap, projects, indicators]
                        });

            var baseLayers = {"OpenStreet": baseMap,
                              "GrayScale": grayscale,
                              "Topography": opentopomap,

                              };

            var overlays = { {% for narrative in getOverlayNarrative %}
                                "{{narrative.overlay_title}}": {{narrative.overlay_group.overlay_group}},
                             {% endfor %} };

            L.control.layers(baseLayers, overlays).addTo(map);
            var sidebar = L.control.sidebar('sidebar').addTo(map);

            //AFG country boundary geoJSON
            var AFGLayer = L.geoJson().addTo(map);
            $.getJSON("{{ STATIC_URL }}publicdashboard/js/AFG.geo.json", function(json) {
            AFGLayer.addData(json);
            });

            //invest_khandahar.geoJSON data (from http://earthquake.usgs.gov) - TODO - prepare INVEST-in-Khandahar geoJSON
           function addDataToMap(data, map){
               L.geoJson(data, {
                    pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {
                      icon: greenIcon
                            });
                        },
                    onEachFeature: function(feature, layer) {
                        var popupText = "Magnitude: " + feature.properties.mag + "<br>Location: " + feature.properties.place + "<br><a href='" + feature.properties.url + "'>More info</a>";
                        layer.bindPopup(popupText);
                    }
               }).addTo(projects);
            }
            $.getJSON("{{ STATIC_URL }}publicdashboard/js/invest_khandahar.geojson", function(data){ addDataToMap(data, map); });

            //narrative placeholders
            {% for text in getOverlayNarrative %}
                narrativeTitle[{{forloop.counter}}] = "{{text.narrative_title}}";
                narrativeTXT[{{forloop.counter}}] = "{{text.narrative}}";
                overlay[{{forloop.counter}}] = "{{text.overlay_title}}";
            {% endfor %}

            var testNarrative = L.control({position: 'bottomleft'}),
                dashNarrative = L.control({position: 'bottomleft'});

            dashNarrative.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info narrative');
                div.innerHTML +=
                "<strong>"+narrativeTitle[1]+":</strong><br/>" + narrativeTXT[1];
                return div;
                };

            testNarrative.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info narrative');
                div.innerHTML +=
                "<strong>"+narrativeTitle[2]+":</strong><br/>" + narrativeTXT[2];
                return div;
                };

            dashNarrative.addTo(map);

            map.on('overlayadd', function (eventLayer) {
                if (eventLayer.name === overlay[2]) {
                    this.removeControl(dashNarrative);
                    testNarrative.addTo(this);
                }
            });
            map.on('overlayremove', function (eventLayer) {
                if (eventLayer.name === overlay[2]) {
                    this.removeControl(testNarrative);
                    dashNarrative.addTo(this);
                }
            });

            var photoLayer = L.photo.cluster().on('click', function (evt) {
		        var photo = evt.layer.photo,
			        template = '<a><img src="{url}"/></a><p>{caption}</p>';

		        if (photo.video && (!!document.createElement('video').canPlayType('video/mp4; codecs=avc1.42E01E,mp4a.40.2'))) {
			        template = '<video autoplay controls poster="{url}"><source src="{video}" type="video/mp4"/></video>';
		            };

		    evt.layer.bindPopup(L.Util.template(template, photo), {
			    className: 'leaflet-popup-photo',
			    minWidth: 400
		        }).openPopup();
	        });

	        reqwest({
		        url: 'https://picasaweb.google.com/data/feed/api/user/114670224825998987940/albumid/6277837931786391457?alt=json-in-script',
		        type: 'jsonp',
		        success: function (data) {
			        var photos = [];
			        data = data.feed.entry;
			            for (var i = 0; i < data.length; i++) {
				            var photo = data[i];
				            if (photo['georss$where']) {
					            var pos = photo['georss$where']['gml$Point']['gml$pos']['$t'].split(' ');
					            photos.push({
						                lat: pos[0],
						                lng: pos[1],
						                url: photo['media$group']['media$content'][0].url,
						                caption: photo['media$group']['media$description']['$t'],
						                thumbnail: photo['media$group']['media$thumbnail'][0].url,
						                video: (photo['media$group']['media$content'][1] ? photo['media$group']['media$content'][1].url : null)
					                    });
				            };
			}
			photoLayer.add(photos).addTo(VTC);
			map.fitBounds(photoLayer.getBounds());
		}
	});
        </script>
    </div>

    <div class="col-md-12">
        <div class="row tools">
            <h3>Project Status and Key Performance Indicators</h3>

            <div class="list-group col-md-6">

                                    <h4>What is the current project status? </h4>

                                    Number of Initiations : <b>{{ getProjectsCount }}</b><br>

                                   <h4>
                                       <span class="label label-success">Approved &nbsp;<span class="badge">0</span></span>
                                       <span class="label label-success">Awaiting Approval &nbsp;<span class="badge">0</span></span>
                                       <span class="label label-success">In Progress &nbsp;<span class="badge">0</span></span>
                                       <span class="label label-success">Rejected &nbsp;<span class="badge">0</span></span>

                                      </a>
                                    </h4>

                      </div>
                      <div class="list-group  col-md-6">
                          <div class="panel-heading home-paneltitle">
                          <table class="table table-striped">
                                  <tr>
                                      <td colspan="5"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#summary" href="#collapse2"><b><span class="glyphicon glyphicon-plus-sign"></span></b>
                                          At what stages are these project initiations at?</a></h4></td>
                                  </tr>
                                  <tr>
                                      <td colspan="5">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#summary" href="#collapse1">
                                            <b><span class="glyphicon glyphicon-plus-sign"></span></b> Key Performance Indicators (KPIs) </a>
                                         </h4>
                                      </td>
                                  </tr>

                          </table>
                          </div>
                      </div>
            </div>
                <div class="panel-group" id="summary">
                        <div class="panel home-panel">
                          <div id="collapse2" class="panel-collapse collapse">
                              <table class="table table-striped">
                                  <tr>
                                      <td colspan="5"><b>Summary of project initiations for - {% if getProgram %}{{ getProgram.name }}{% endif %}</b></td>
                                  </tr>
                                  <tr>
                                      <th>Initiation#</th>
                                      <th>Title</th>
                                      <th>Status</th>
                                      <th>Date</th>
                                      <th>AAM</th>
                                  </tr>
                                  {% for item in recent_tickets %}
                                  <tr>
                                      <td>{% if item.status == 1 %} Open {%elif item.status == 2%}Re-Opened{% elif item.status == 3%}Resolved{% elif item.status == 4%}Closed{% elif item.status == 5%}Duplicate{% endif %}</td>
                                      <td>{{ item.queue }}</td>
                                      <td><a href="/helpdesk/tickets/{{ item.id }}/">{{ item.title }}</a></td>
                                      <td>{{ item.created }}</td>
                                      <td>{{ item.created }}</td>
                                  </tr>
                                  {% endfor %}
                              </table>
                              <div class="container clearfix">
                                  <div class="third widget doughnut">
                                      <h4>

                                          Project Status
                                      </h4>
                                        <div id="status-legend" class="chart-legend"></div>
                                      <div class="canvas-container-fixed">
                                          <canvas id="status"></canvas>
                                      </div>
                                      <b>Total number of Projects:</b> ( {{ total_projects }} )
                                  </div>
                                  <div class="third widget line">
                                    <div class="chart-legend">
                                        <h4>Program Expenditure</h4>
                                        <div class="canvas-container-fixed">
                                            <canvas id="expenditure_canvas"></canvas>
                                        </div>
                                        <div id="exp-legend"></div>
                                    </div>
                                  </div>
                                  <div class="third widget">
                                      <div class="chart-legend">
                                          <h4>Survey Responses</h4>
                                          <span>How do you rate our program team ?</span>
                                      </div>
                                      <div class="canvas-container-fixed">
                                          <canvas id="surveys"></canvas>
                                      </div>
                                  </div>
                            </div>

                          </div><!-- end of collapse2 -->
                    </div>
                    <div class="panel home-panel">
                      <div id="collapse1" class="panel-collapse collapse">
                          <div class="container clearfix widget">

                                    <div class="chart-legend">
                                        <h4>Key Performance Indicators (KPIs)</h4>
                                        <div id="kpi-legend"></div>
                                        <p><span>Targets</span> Vs <strong>Actuals</strong></p>
                                        {% if getProgram %}{{ getProgram.name }}{% endif %}
                                    </div>
                                    <div class="canvas-container">
                                        <canvas id="kpi"></canvas>
                                    </div>

                          </div>
                      </div>
                    </div>

              </div>
            <div class="push"></div>
        </div>
        <script src="{{ STATIC_URL }}publicdashboard/js/vendor/jquery-1.11.1.min.js"></script>
        <script src="{{ STATIC_URL }}publicdashboard/js/plugins.js"></script>
        <script>

//render project_status in a doughnut chart
var status_options = {

    // single tooltip
    tooltipTemplate: "<%=label + ' Projects' %>",
};
var status_data = [
    {
    value: {{ approved }},
    color:"#637b85",
    label: "Approved - {{ approved }}"
    },
    {
    value : {{ awaiting }},
    color : "#2c9c69",
    label: "Waiting - {{ awaiting }}"
    },
    {
    value : {{ rejected }},
    color : "#dbba34",
    label: "Rejected - {{ rejected }}"
    },
    {
    value : {{ in_progress }},
    color : "#c62f29",
    label: "In Progress - {{ in_progress }}"
    }
];
var ctx = document.getElementById("status").getContext("2d");
var statusChart = new Chart(ctx).Doughnut(status_data,status_options);
document.getElementById('status-legend').innerHTML = statusChart.generateLegend();

//KPI JSON data object
var kpi_options = {
    maintainAspectRatio: false,
    responsive: true,
    scaleOverlay : false,

    scaleSteps : 10,
    scaleStepWidth : 10,
    scaleStartValue : 0,
    scaleLineColor : "rgba(0,0,0,.25)",
    scaleLineWidth : 1,
    scaleShowLabels : true,
    scaleLabel : "<%=value%>",
    scaleFontFamily : "'Lato'",
    scaleFontSize : 12,
    scaleFontStyle : "800",
    scaleFontColor : "#222",
    scaleShowGridLines : true,
    scaleGridLineColor : "rgba(0,0,0,.1)",
    scaleGridLineWidth : 1,
    bezierCurve : true,
    pointDot : true,
    pointDotRadius : 5,
    pointDotStrokeWidth : 1,
    datasetStroke : true,
    datasetStrokeWidth : 1,
    datasetFill : true,
    animation : true,
    animationSteps : 120,
    animationEasing : "easeOutQuart",
    onAnimationComplete : null,
};
var kpi_data = {
    labels : [{% for program in getQuantitativeDataSums %} "{{ program.indicator__number }}", {% endfor %}],
    datasets : [
        {
            label: "KPI Targets",
            fillColor: "rgba(220,220,220,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(220,220,220,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [{% for program in getQuantitativeDataSums %} "{{ program.targets }}", {% endfor %}],
            //data : [65,59,90,41,56,55,40]
        },
        {
            label: "KPI Actuals",
            fillColor: "rgba(151,187,205,0.5)",
            strokeColor: "rgba(151,187,205,0.8)",
            highlightFill: "rgba(151,187,205,0.75)",
            highlightStroke: "rgba(151,187,205,1)",
            data: [{% for program in getQuantitativeDataSums %} "{{ program.actuals }}", {% endfor %}],
            //data : [28,48,40,19,96,27,100]
        }
    ]
}
//retrieve kpi_canvas, pass the kpi_JSON into a Line_chart
var ctx = document.getElementById("kpi").getContext("2d");
var kpiChart = new Chart(ctx).Bar(kpi_data, kpi_options);
document.getElementById('kpi-legend').innerHTML = kpiChart.generateLegend();

//render program_expenditure on bar_chart
    var expenditure_options = {
        maintainAspectRatio: false,
        responsive: true,
        scaleOverlay : false,
        scaleSteps : 10,
        scaleStepWidth : 10,
        scaleStartValue : 0,
        scaleLineColor : "rgba(0,0,0,.25)",
        scaleLineWidth : 1,
        scaleShowLabels : true,
        scaleLabel : "<%=value%>",
        scaleFontFamily : "'Lato'",
        scaleFontSize : 12,
        scaleFontStyle : "800",
        scaleFontColor : "#222",
        scaleShowGridLines : true,
        scaleGridLineColor : "rgba(0,0,0,.1)",
        scaleGridLineWidth : 1,
        bezierCurve : true,
        pointDot : true,
        pointDotRadius : 5,
        pointDotStrokeWidth : 1,
        datasetStroke : true,
        datasetStrokeWidth : 1,
        datasetFill : true,
        animation : true,
        animationSteps : 120,
        animationEasing : "easeOutQuart",
        onAnimationComplete : null,
        //tooltip
        multiTooltipTemplate: "<%= value + ' USD' %>",
    };
    var expenditure_data = {
        labels: [{% for project in getProjects %} {{ project.id }},{% endfor %}],
        datasets: [
            {
                label: "Budgeted",
                fillColor: "rgba(220,220,220,0.5)",
                strokeColor: "rgba(220,220,220,0.8)",
                highlightFill: "rgba(220,220,220,0.75)",
                highlightStroke: "rgba(220,220,220,1)",
                data : [{% for project in getProjects %} {{ project.actual_budget }},{% endfor %}]
            },
            {
                label: "Actuals",
                fillColor: "rgba(151,187,205,0.5)",
                strokeColor: "rgba(151,187,205,0.8)",
                highlightFill: "rgba(151,187,205,0.75)",
                highlightStroke: "rgba(151,187,205,1)",
                data : [{% for project in getProjects %} {{ project.total_cost }},{% endfor %}]
            }
        ]
    };
    //retrieve expenditure_canvas, pass the expenditure_JSON into a bar_chart
    var ctx = document.getElementById("expenditure_canvas").getContext("2d");
    var expChart = new Chart(ctx).Bar(expenditure_data,expenditure_options);
    document.getElementById('exp-legend').innerHTML = expChart.generateLegend();

    //render survey_responses on radar_chart
    var survey_data = {
        //labels : [{% for program in getQuantitativeDataSums_2 %} "{{ program.indicator__source }}", {% endfor %}],
        labels : ["Helpful","Friendly","Kind","Rude","Slow","Frustrating"],
        datasets : [
            {
                fillColor : "rgba(220,220,220,0.5)",
                strokeColor : "#637b85",
                pointColor : "#dbba34",
                pointStrokeColor : "#637b85",
                //data : [{% for project in getProjects %} {{ project.mc_estimated_budget }},{% endfor %}]
                data : [65,59,90,81,30,56]
            }
        ]
    }
    var ctx = document.getElementById("surveys").getContext("2d");
    new Chart(ctx).Radar(survey_data);
</script>

</div>
{% endblock content %}